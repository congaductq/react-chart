{"version":3,"sources":["../../../src/lib/series/KagiSeries.js"],"names":["KagiSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","getAxisCanvas","xScale","yScale","chartConfig","plotData","className","stroke","fill","strokeWidth","paths","helper","map","each","i","dataSeries","x","item","y","curve","curveStepBefore","plot","type","Component","propTypes","PropTypes","string","object","number","isRequired","defaultProps","yang","yin","currentValueStroke","begin","forEach","strokeStyle","lineWidth","beginPath","prevX","d","moveTo","lineTo","lastPlot","length","last","y1","y2","kagiLine","kagi","idx","close","startAs","push","open","changeTo","changePoint","added","current","reverseAt"],"mappings":"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","file":"KagiSeries.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { line, curveStepBefore } from \"d3-shape\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\nimport { isDefined, isNotDefined } from \"../utils\";\r\n\r\nclass KagiSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\r\n\t\tdrawOnCanvas(ctx, this.props, moreProps, xAccessor);\r\n\t}\r\n\trender() {\r\n\t\treturn <GenericChartComponent\r\n\t\t\tsvgDraw={this.renderSVG}\r\n\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\t\t\tdrawOn={[\"pan\"]}\r\n\t\t/>;\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tconst { xAccessor } = moreProps;\r\n\t\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\t\tconst { className, stroke, fill, strokeWidth } = this.props;\r\n\r\n\t\tconst paths = helper(plotData, xAccessor).map((each, i) => {\r\n\t\t\tconst dataSeries = line()\r\n\t\t\t\t.x((item) => xScale(item[0]))\r\n\t\t\t\t.y((item) => yScale(item[1]))\r\n\t\t\t\t.curve(curveStepBefore);\r\n\r\n\t\t\tdataSeries(each.plot);\r\n\r\n\t\t\treturn (<path key={i} d={dataSeries(each.plot)} className={each.type}\r\n\t\t\t\tstroke={stroke[each.type]} fill={fill[each.type]} strokeWidth={strokeWidth} />);\r\n\t\t});\r\n\t\treturn (\r\n\t\t\t<g className={className}>\r\n\t\t\t\t{paths}\r\n\t\t\t</g>\r\n\t\t);\r\n\t}\r\n}\r\nKagiSeries.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tstroke: PropTypes.object,\r\n\tfill: PropTypes.object,\r\n\tstrokeWidth: PropTypes.number.isRequired,\r\n};\r\n\r\nKagiSeries.defaultProps = {\r\n\tclassName: \"react-stockcharts-kagi\",\r\n\tstrokeWidth: 2,\r\n\tstroke: {\r\n\t\tyang: \"#6BA583\",\r\n\t\tyin: \"#E60000\"\r\n\t},\r\n\tfill: {\r\n\t\tyang: \"none\",\r\n\t\tyin: \"none\"\r\n\t},\r\n\tcurrentValueStroke: \"#000000\",\r\n};\r\n\r\nfunction drawOnCanvas(ctx, props, moreProps, xAccessor) {\r\n\tconst { stroke, strokeWidth, currentValueStroke } = props;\r\n\tconst { xScale, chartConfig: { yScale }, plotData } = moreProps;\r\n\r\n\tconst paths = helper(plotData, xAccessor);\r\n\r\n\tlet begin = true;\r\n\r\n\tpaths.forEach((each) => {\r\n\t\tctx.strokeStyle = stroke[each.type];\r\n\t\tctx.lineWidth = strokeWidth;\r\n\r\n\t\tctx.beginPath();\r\n\t\tlet prevX;\r\n\t\teach.plot.forEach(d => {\r\n\t\t\tconst [x, y] = [xScale(d[0]), yScale(d[1])];\r\n\t\t\tif (begin) {\r\n\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\tbegin = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (isDefined(prevX)) {\r\n\t\t\t\t\tctx.lineTo(prevX, y);\r\n\t\t\t\t}\r\n\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t}\r\n\t\t\tprevX = x;\r\n\t\t\t// console.log(d);\r\n\r\n\t\t});\r\n\t\tctx.stroke();\r\n\t});\r\n\tconst lastPlot = paths[paths.length - 1].plot;\r\n\tconst last = lastPlot[lastPlot.length - 1];\r\n\tctx.beginPath();\r\n\t// ctx.strokeStyle = \"black\";\r\n\tctx.lineWidth = 1;\r\n\r\n\tconst [x, y1, y2] = [xScale(last[0]), yScale(last[2]), yScale(last[3])];\r\n\t// console.log(last, x, y);\r\n\tctx.moveTo(x, y1);\r\n\tctx.lineTo(x + 10, y1);\r\n\tctx.stroke();\r\n\r\n\tctx.beginPath();\r\n\tctx.strokeStyle = currentValueStroke;\r\n\tctx.moveTo(x - 10, y2);\r\n\tctx.lineTo(x, y2);\r\n\tctx.stroke();\r\n}\r\n\r\nfunction helper(plotData, xAccessor) {\r\n\tconst kagiLine = [];\r\n\tlet kagi = {};\r\n\tlet d = plotData[0];\r\n\tlet idx = xAccessor(d);\r\n\r\n\tfor (let i = 0; i < plotData.length; i++) {\r\n\t\td = plotData[i];\r\n\r\n\t\tif (isNotDefined(d.close)) continue;\r\n\t\tif (isNotDefined(kagi.type)) kagi.type = d.startAs;\r\n\t\tif (isNotDefined(kagi.plot)) kagi.plot = [];\r\n\r\n\t\tidx = xAccessor(d);\r\n\t\tkagi.plot.push([idx, d.open]);\r\n\r\n\t\tif (isDefined(d.changeTo)) {\r\n\t\t\tkagi.plot.push([idx, d.changePoint]);\r\n\t\t\tkagi.added = true;\r\n\t\t\tkagiLine.push(kagi);\r\n\r\n\t\t\tkagi = {\r\n\t\t\t\ttype: d.changeTo,\r\n\t\t\t\tplot: [],\r\n\t\t\t\tadded: false,\r\n\t\t\t};\r\n\t\t\tkagi.plot.push([idx, d.changePoint]);\r\n\t\t}\r\n\t}\r\n\r\n\tif (!kagi.added) {\r\n\t\tkagi.plot.push([idx, d.close, d.current, d.reverseAt]);\r\n\t\tkagiLine.push(kagi);\r\n\t}\r\n\r\n\t// console.log(d.reverseAt);\r\n\r\n\treturn kagiLine;\r\n}\r\n\r\nexport default KagiSeries;\r\n"]}