{"version":3,"sources":["../../src/lib/EventCapture.js"],"names":["EventCapture","props","handleEnter","bind","handleLeave","handleWheel","handleMouseMove","handleMouseDown","handlePanEnd","handlePan","handleTouchStart","handleTouchMove","handlePinchZoom","handlePinchZoomEnd","handleClick","handleRightClick","handleDrag","handleDragEnd","shouldPan","canPan","setCursorClass","saveNode","mouseInside","mouseInteraction","state","panInProgress","node","focus","on","MOUSEENTER","MOUSELEAVE","componentDidMount","win","MOUSEMOVE","e","d3Event","onMouseEnter","dragInProgress","onMouseLeave","zoom","onZoom","yZoom","Math","abs","deltaY","deltaX","mouseXY","preventDefault","zoomDir","panStart","panStartXScale","chartsToPan","lastNewPos","panHappened","dx","dy","dxdy","onPan","xScale","chartConfig","currentCharts","setState","panOrigin","queuePanEnd","panEndTimeout","clearTimeout","setTimeout","onMouseMove","mouseMove","newPos","onClick","onDoubleClick","dragHappened","clicked","stopPropagation","onContextMenu","onPanEnd","getBoundingClientRect","MOUSEUP","onDrag","startPos","dragStartPosition","onDragComplete","getAllPanConditions","initialPanEnabled","pan","reduce","returnObj","a","draggable","panEnabled","somethingSelected","button","onMouseDown","onDragStart","TOUCHMOVE","TOUCHEND","touchXY","touches","length","touch1Pos","touch2Pos","pinchZoomStart","range","zoomEnabled","onPinchZoom","initialPinch","onPinchZoomEnd","cursorOverrideClass","height","width","disableInteraction","useCrossHairStyleCursor","className","interactionProps","onWheel","onTouchStart","onTouchMove","opacity","Component","propTypes","PropTypes","bool","isRequired","panSpeedMultiplier","number","array","func","xAccessor","children","defaultProps","noop"],"mappings":"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","file":"EventCapture.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { select, event as d3Event, mouse, touches } from \"d3-selection\";\r\n\r\nimport {\r\n\tisDefined, mousePosition, touchPosition, getTouchProps,\r\n\td3Window,\r\n\tMOUSEMOVE, MOUSEUP,\r\n\tMOUSEENTER, MOUSELEAVE,\r\n\tTOUCHMOVE, TOUCHEND,\r\n\tnoop\r\n} from \"./utils\";\r\nimport { getCurrentCharts } from \"./utils/ChartDataUtil\";\r\n// import { clearTimeout, setTimeout } from \"timers\";\r\n\r\nclass EventCapture extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.handleEnter = this.handleEnter.bind(this);\r\n\t\tthis.handleLeave = this.handleLeave.bind(this);\r\n\t\tthis.handleWheel = this.handleWheel.bind(this);\r\n\t\tthis.handleMouseMove = this.handleMouseMove.bind(this);\r\n\t\tthis.handleMouseDown = this.handleMouseDown.bind(this);\r\n\t\tthis.handlePanEnd = this.handlePanEnd.bind(this);\r\n\t\tthis.handlePan = this.handlePan.bind(this);\r\n\t\tthis.handleTouchStart = this.handleTouchStart.bind(this);\r\n\t\tthis.handleTouchMove = this.handleTouchMove.bind(this);\r\n\t\tthis.handlePinchZoom = this.handlePinchZoom.bind(this);\r\n\t\tthis.handlePinchZoomEnd = this.handlePinchZoomEnd.bind(this);\r\n\r\n\t\tthis.handleClick = this.handleClick.bind(this);\r\n\r\n\t\tthis.handleRightClick = this.handleRightClick.bind(this);\r\n\t\tthis.handleDrag = this.handleDrag.bind(this);\r\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\r\n\r\n\t\tthis.shouldPan = this.shouldPan.bind(this);\r\n\t\tthis.canPan = this.canPan.bind(this);\r\n\r\n\t\tthis.setCursorClass = this.setCursorClass.bind(this);\r\n\t\tthis.saveNode = this.saveNode.bind(this);\r\n\r\n\t\tthis.mouseInside = false;\r\n\r\n\t\tthis.mouseInteraction = true;\r\n\t\tthis.state = {\r\n\t\t\tpanInProgress: false,\r\n\t\t};\r\n\t}\r\n\tsaveNode(node) {\r\n\t\tthis.node = node;\r\n\t}\r\n\tcomponentWillMount() {\r\n\t\tthis.focus = this.props.focus;\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tif (this.node) {\r\n\t\t\tselect(this.node)\r\n\t\t\t\t.on(MOUSEENTER, this.handleEnter)\r\n\t\t\t\t.on(MOUSELEAVE, this.handleLeave);\r\n\t\t}\r\n\t}\r\n\tcomponentDidUpdate() {\r\n\t\tthis.componentDidMount();\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.node) {\r\n\t\t\tselect(this.node)\r\n\t\t\t\t.on(MOUSEENTER, null)\r\n\t\t\t\t.on(MOUSELEAVE, null);\r\n\t\t\tconst win = d3Window(this.node);\r\n\t\t\tselect(win)\r\n\t\t\t\t.on(MOUSEMOVE, null);\r\n\t\t}\r\n\t}\r\n\thandleEnter() {\r\n\t\tconst e = d3Event;\r\n\r\n\t\tconst { onMouseEnter } = this.props;\r\n\t\tthis.mouseInside = true;\r\n\t\tif (!this.state.panInProgress\r\n\t\t\t\t&& !this.state.dragInProgress) {\r\n\t\t\tconst win = d3Window(this.node);\r\n\t\t\tselect(win)\r\n\t\t\t\t.on(MOUSEMOVE, this.handleMouseMove);\r\n\t\t}\r\n\t\tonMouseEnter(e);\r\n\t}\r\n\thandleLeave(e) {\r\n\t\tconst { onMouseLeave } = this.props;\r\n\t\tthis.mouseInside = false;\r\n\t\tif (!this.state.panInProgress\r\n\t\t\t\t&& !this.state.dragInProgress) {\r\n\t\t\tconst win = d3Window(this.node);\r\n\t\t\tselect(win)\r\n\t\t\t\t.on(MOUSEMOVE, null);\r\n\t\t}\r\n\t\tonMouseLeave(e);\r\n\t}\r\n\thandleWheel(e) {\r\n\t\tconst { zoom, onZoom } = this.props;\r\n\t\tconst { panInProgress } = this.state;\r\n\r\n\t\tconst yZoom = Math.abs(e.deltaY) > Math.abs(e.deltaX) && Math.abs(e.deltaY) > 0;\r\n\t\t// const xPan = Math.abs(e.deltaY) < Math.abs(e.deltaX) && Math.abs(e.deltaX) > 0;\r\n\t\tconst mouseXY = mousePosition(e);\r\n\t\te.preventDefault();\r\n\r\n\t\tif (zoom && this.focus && yZoom && !panInProgress) {\r\n\t\t\tconst zoomDir = e.deltaY > 0 ? 1 : -1;\r\n\r\n\t\t\tonZoom(zoomDir, mouseXY, e);\r\n\t\t} else if (this.focus) {\r\n\t\t\tif (this.shouldPan()) {\r\n\t\t\t\t// console.log(\"Do pan now...\")\r\n\t\t\t\t// pan already in progress\r\n\t\t\t\tconst {\r\n\t\t\t\t\tpanStartXScale,\r\n\t\t\t\t\tchartsToPan\r\n\t\t\t\t} = this.state.panStart;\r\n\t\t\t\tthis.lastNewPos = mouseXY;\r\n\t\t\t\tthis.panHappened = true;\r\n\r\n\t\t\t\tthis.dx += e.deltaX;\r\n\t\t\t\tthis.dy += e.deltaY;\r\n\t\t\t\tconst dxdy = { dx: this.dx, dy: this.dy };\r\n\r\n\t\t\t\tthis.props.onPan(mouseXY, panStartXScale, dxdy, chartsToPan, e);\r\n\t\t\t} else {\r\n\t\t\t\t// console.log(\"Pan start...\")\r\n\t\t\t\t// pan start\r\n\r\n\t\t\t\tconst { xScale, chartConfig } = this.props;\r\n\t\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\r\n\t\t\t\tthis.dx = 0;\r\n\t\t\t\tthis.dy = 0;\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tpanInProgress: true,\r\n\t\t\t\t\tpanStart: {\r\n\t\t\t\t\t\tpanStartXScale: xScale,\r\n\t\t\t\t\t\tpanOrigin: mouseXY,\r\n\t\t\t\t\t\tchartsToPan: currentCharts\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.queuePanEnd();\r\n\t\t}\r\n\t}\r\n\tqueuePanEnd() {\r\n\t\tif (isDefined(this.panEndTimeout)) {\r\n\t\t\tclearTimeout(this.panEndTimeout);\r\n\t\t}\r\n\t\tthis.panEndTimeout = setTimeout(() => {\r\n\t\t\tthis.handlePanEnd();\r\n\t\t}, 100);\r\n\t}\r\n\thandleMouseMove() {\r\n\t\tconst e = d3Event;\r\n\r\n\t\tconst { onMouseMove, mouseMove } = this.props;\r\n\r\n\t\tif (this.mouseInteraction\r\n\t\t\t\t&& mouseMove\r\n\t\t\t\t&& !this.state.panInProgress) {\r\n\r\n\t\t\tconst newPos = mouse(this.node);\r\n\r\n\t\t\tonMouseMove(newPos, \"mouse\", e);\r\n\t\t}\r\n\t}\r\n\thandleClick(e) {\r\n\t\tconst mouseXY = mousePosition(e);\r\n\t\tconst { onClick, onDoubleClick } = this.props;\r\n\r\n\t\tif (!this.panHappened && !this.dragHappened) {\r\n\t\t\tif (this.clicked) {\r\n\t\t\t\tonDoubleClick(mouseXY, e);\r\n\t\t\t\tthis.clicked = false;\r\n\t\t\t} else {\r\n\t\t\t\tonClick(mouseXY, e);\r\n\t\t\t\tthis.clicked = true;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (this.clicked) {\r\n\t\t\t\t\t\tthis.clicked = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 400);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\thandleRightClick(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t\tconst { onContextMenu, onPanEnd } = this.props;\r\n\r\n\t\tconst mouseXY = mousePosition(e, this.node.getBoundingClientRect());\r\n\r\n\t\tif (isDefined(this.state.panStart)) {\r\n\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = this.state.panStart;\r\n\t\t\tif (this.panHappened) {\r\n\t\t\t\tonPanEnd(mouseXY, panStartXScale, panOrigin, chartsToPan, e);\r\n\t\t\t}\r\n\t\t\tconst win = d3Window(this.node);\r\n\t\t\tselect(win)\r\n\t\t\t\t.on(MOUSEMOVE, null)\r\n\t\t\t\t.on(MOUSEUP, null);\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tpanInProgress: false,\r\n\t\t\t\tpanStart: null,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tonContextMenu(mouseXY, e);\r\n\t}\r\n\r\n\thandleDrag() {\r\n\t\tconst e = d3Event;\r\n\t\tif (this.props.onDrag) {\r\n\t\t\tthis.dragHappened = true;\r\n\t\t\tconst mouseXY = mouse(this.node);\r\n\t\t\tthis.props.onDrag({\r\n\t\t\t\tstartPos: this.state.dragStartPosition,\r\n\t\t\t\tmouseXY\r\n\t\t\t}, e);\r\n\t\t}\r\n\t}\r\n\tcancelDrag() {\r\n\t\tconst win = d3Window(this.node);\r\n\t\tselect(win)\r\n\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\r\n\t\t\t.on(MOUSEUP, null);\r\n\r\n\t\tthis.setState({\r\n\t\t\tdragInProgress: false,\r\n\t\t});\r\n\t\tthis.mouseInteraction = true;\r\n\t}\r\n\thandleDragEnd() {\r\n\t\tconst e = d3Event;\r\n\t\tconst mouseXY = mouse(this.node);\r\n\r\n\t\tconst win = d3Window(this.node);\r\n\t\tselect(win)\r\n\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\r\n\t\t\t.on(MOUSEUP, null);\r\n\r\n\t\tif (this.dragHappened) {\r\n\t\t\tthis.props.onDragComplete({\r\n\t\t\t\tmouseXY\r\n\t\t\t}, e);\r\n\t\t}\r\n\r\n\t\tthis.setState({\r\n\t\t\tdragInProgress: false,\r\n\t\t});\r\n\t\tthis.mouseInteraction = true;\r\n\t}\r\n\tcanPan() {\r\n\t\tconst { getAllPanConditions } = this.props;\r\n\t\tconst { pan: initialPanEnabled } = this.props;\r\n\r\n\t\tconst {\r\n\t\t\tpanEnabled,\r\n\t\t\tdraggable: somethingSelected\r\n\t\t} = getAllPanConditions()\r\n\t\t\t.reduce((returnObj, a) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdraggable: returnObj.draggable || a.draggable,\r\n\t\t\t\t\tpanEnabled: returnObj.panEnabled && a.panEnabled,\r\n\t\t\t\t};\r\n\t\t\t}, {\r\n\t\t\t\tdraggable: false,\r\n\t\t\t\tpanEnabled: initialPanEnabled,\r\n\t\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tpanEnabled,\r\n\t\t\tsomethingSelected\r\n\t\t};\r\n\t}\r\n\thandleMouseDown(e) {\r\n\t\tif (e.button !== 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst { xScale, chartConfig, onMouseDown } = this.props;\r\n\r\n\t\tthis.panHappened = false;\r\n\t\tthis.dragHappened = false;\r\n\t\tthis.focus = true;\r\n\r\n\t\tif (!this.state.panInProgress\r\n\t\t\t&& this.mouseInteraction\r\n\t\t) {\r\n\r\n\t\t\tconst mouseXY = mousePosition(e);\r\n\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\r\n\t\t\tconst {\r\n\t\t\t\tpanEnabled, somethingSelected\r\n\t\t\t} = this.canPan();\r\n\t\t\tconst pan = panEnabled && !somethingSelected;\r\n\r\n\t\t\tif (pan) {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tpanInProgress: pan,\r\n\t\t\t\t\tpanStart: {\r\n\t\t\t\t\t\tpanStartXScale: xScale,\r\n\t\t\t\t\t\tpanOrigin: mouseXY,\r\n\t\t\t\t\t\tchartsToPan: currentCharts\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst win = d3Window(this.node);\r\n\t\t\t\tselect(win)\r\n\t\t\t\t\t.on(MOUSEMOVE, this.handlePan)\r\n\t\t\t\t\t.on(MOUSEUP, this.handlePanEnd);\r\n\r\n\t\t\t} else if (somethingSelected) {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tpanInProgress: false,\r\n\t\t\t\t\tdragInProgress: true,\r\n\t\t\t\t\tpanStart: null,\r\n\t\t\t\t\tdragStartPosition: mouseXY,\r\n\t\t\t\t});\r\n\t\t\t\tthis.props.onDragStart({ startPos: mouseXY }, e);\r\n\t\t\t\t// this.mouseInteraction = false;\r\n\r\n\t\t\t\tconst win = d3Window(this.node);\r\n\t\t\t\tselect(win)\r\n\t\t\t\t\t.on(MOUSEMOVE, this.handleDrag)\r\n\t\t\t\t\t.on(MOUSEUP, this.handleDragEnd);\r\n\t\t\t}\r\n\r\n\t\t\tonMouseDown(mouseXY, currentCharts, e);\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t}\r\n\tshouldPan() {\r\n\t\tconst { pan: panEnabled, onPan } = this.props;\r\n\t\treturn panEnabled\r\n\t\t\t&& onPan\r\n\t\t\t&& isDefined(this.state.panStart);\r\n\t}\r\n\thandlePan() {\r\n\t\tconst e = d3Event;\r\n\r\n\t\tif (this.shouldPan()) {\r\n\t\t\tthis.panHappened = true;\r\n\r\n\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = this.state.panStart;\r\n\r\n\t\t\tconst mouseXY = this.mouseInteraction\r\n\t\t\t\t? mouse(this.node)\r\n\t\t\t\t: touches(this.node)[0];\r\n\r\n\t\t\tthis.lastNewPos = mouseXY;\r\n\t\t\tconst dx = mouseXY[0] - panOrigin[0];\r\n\t\t\tconst dy = mouseXY[1] - panOrigin[1];\r\n\r\n\t\t\tthis.dx = dx;\r\n\t\t\tthis.dy = dy;\r\n\r\n\t\t\tthis.props.onPan(\r\n\t\t\t\tmouseXY, panStartXScale, { dx, dy }, chartsToPan, e\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\thandlePanEnd() {\r\n\t\tconst e = d3Event;\r\n\t\tconst { pan: panEnabled, onPanEnd } = this.props;\r\n\r\n\t\tif (isDefined(this.state.panStart)) {\r\n\t\t\tconst { panStartXScale, chartsToPan } = this.state.panStart;\r\n\r\n\t\t\tconst win = d3Window(this.node);\r\n\t\t\tselect(win)\r\n\t\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\r\n\t\t\t\t.on(MOUSEUP, null)\r\n\t\t\t\t.on(TOUCHMOVE, null)\r\n\t\t\t\t.on(TOUCHEND, null);\r\n\r\n\t\t\tif (this.panHappened\r\n\t\t\t\t\t// && !this.contextMenuClicked\r\n\t\t\t\t\t&& panEnabled\r\n\t\t\t\t\t&& onPanEnd) {\r\n\t\t\t\tconst { dx, dy } = this;\r\n\r\n\t\t\t\t// console.log(dx, dy)\r\n\t\t\t\tdelete this.dx;\r\n\t\t\t\tdelete this.dy;\r\n\t\t\t\tonPanEnd(this.lastNewPos, panStartXScale, { dx, dy }, chartsToPan, e);\r\n\t\t\t}\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\tpanInProgress: false,\r\n\t\t\t\tpanStart: null,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\thandleTouchMove(e) {\r\n\t\tconst { onMouseMove } = this.props;\r\n\t\tconst touchXY = touchPosition(getTouchProps(e.touches[0]), e);\r\n\t\tonMouseMove(touchXY, \"touch\", e);\r\n\t}\r\n\thandleTouchStart(e) {\r\n\t\tthis.mouseInteraction = false;\r\n\r\n\t\tconst { pan: panEnabled, chartConfig, onMouseMove } = this.props;\r\n\t\tconst { xScale, onPanEnd } = this.props;\r\n\r\n\t\tif (e.touches.length === 1) {\r\n\r\n\t\t\tthis.panHappened = false;\r\n\t\t\tconst touchXY = touchPosition(getTouchProps(e.touches[0]), e);\r\n\t\t\tonMouseMove(touchXY, \"touch\", e);\r\n\r\n\t\t\tif (panEnabled) {\r\n\t\t\t\tconst currentCharts = getCurrentCharts(chartConfig, touchXY);\r\n\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tpanInProgress: true,\r\n\t\t\t\t\tpanStart: {\r\n\t\t\t\t\t\tpanStartXScale: xScale,\r\n\t\t\t\t\t\tpanOrigin: touchXY,\r\n\t\t\t\t\t\tchartsToPan: currentCharts,\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst win = d3Window(this.node);\r\n\t\t\t\tselect(win)\r\n\t\t\t\t\t.on(TOUCHMOVE, this.handlePan, false)\r\n\t\t\t\t\t.on(TOUCHEND, this.handlePanEnd, false);\r\n\r\n\t\t\t}\r\n\t\t} else if (e.touches.length === 2) {\r\n\t\t\t// pinch zoom begin\r\n\t\t\t// do nothing pinch zoom is handled in handleTouchMove\r\n\t\t\tconst { panInProgress, panStart } = this.state;\r\n\r\n\t\t\tif (panInProgress && panEnabled && onPanEnd) {\r\n\t\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = panStart;\r\n\r\n\t\t\t\tconst win = d3Window(this.node);\r\n\t\t\t\tselect(win)\r\n\t\t\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\r\n\t\t\t\t\t.on(MOUSEUP, null)\r\n\t\t\t\t\t.on(TOUCHMOVE, this.handlePinchZoom, false)\r\n\t\t\t\t\t.on(TOUCHEND, this.handlePinchZoomEnd, false);\r\n\r\n\t\t\t\tconst touch1Pos = touchPosition(getTouchProps(e.touches[0]), e);\r\n\t\t\t\tconst touch2Pos = touchPosition(getTouchProps(e.touches[1]), e);\r\n\r\n\t\t\t\tif (this.panHappened\r\n\t\t\t\t\t\t// && !this.contextMenuClicked\r\n\t\t\t\t\t\t&& panEnabled\r\n\t\t\t\t\t\t&& onPanEnd) {\r\n\r\n\t\t\t\t\tonPanEnd(this.lastNewPos, panStartXScale, panOrigin, chartsToPan, e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tpanInProgress: false,\r\n\t\t\t\t\tpinchZoomStart: {\r\n\t\t\t\t\t\txScale,\r\n\t\t\t\t\t\ttouch1Pos,\r\n\t\t\t\t\t\ttouch2Pos,\r\n\t\t\t\t\t\trange: xScale.range(),\r\n\t\t\t\t\t\tchartsToPan,\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\thandlePinchZoom() {\r\n\t\tconst e = d3Event;\r\n\t\tconst [touch1Pos, touch2Pos] = touches(this.node);\r\n\t\tconst { xScale, zoom: zoomEnabled, onPinchZoom } = this.props;\r\n\r\n\t\t// eslint-disable-next-line no-unused-vars\r\n\t\tconst { chartsToPan, ...initialPinch } = this.state.pinchZoomStart;\r\n\r\n\t\tif (zoomEnabled && onPinchZoom) {\r\n\t\t\tonPinchZoom(initialPinch, {\r\n\t\t\t\ttouch1Pos,\r\n\t\t\t\ttouch2Pos,\r\n\t\t\t\txScale,\r\n\t\t\t}, e);\r\n\t\t}\r\n\t}\r\n\thandlePinchZoomEnd() {\r\n\t\tconst e = d3Event;\r\n\r\n\t\tconst win = d3Window(this.node);\r\n\t\tselect(win)\r\n\t\t\t.on(TOUCHMOVE, null)\r\n\t\t\t.on(TOUCHEND, null);\r\n\r\n\t\tconst { zoom: zoomEnabled, onPinchZoomEnd } = this.props;\r\n\r\n\t\t// eslint-disable-next-line no-unused-vars\r\n\t\tconst { chartsToPan, ...initialPinch } = this.state.pinchZoomStart;\r\n\r\n\t\tif (zoomEnabled && onPinchZoomEnd) {\r\n\t\t\tonPinchZoomEnd(initialPinch, e);\r\n\t\t}\r\n\r\n\t\tthis.setState({\r\n\t\t\tpinchZoomStart: null\r\n\t\t});\r\n\t}\r\n\tsetCursorClass(cursorOverrideClass) {\r\n\t\tif (cursorOverrideClass !== this.state.cursorOverrideClass) {\r\n\t\t\tthis.setState({\r\n\t\t\t\tcursorOverrideClass\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\tconst { height, width, disableInteraction, useCrossHairStyleCursor } = this.props;\r\n\t\tconst className = this.state.cursorOverrideClass != null\r\n\t\t\t? this.state.cursorOverrideClass\r\n\t\t\t: !useCrossHairStyleCursor ? \"\" : this.state.panInProgress\r\n\t\t\t\t? \"react-stockcharts-grabbing-cursor\"\r\n\t\t\t\t: \"react-stockcharts-crosshair-cursor\";\r\n\r\n\t\tconst interactionProps = disableInteraction || {\r\n\t\t\tonWheel: this.handleWheel,\r\n\t\t\tonMouseDown: this.handleMouseDown,\r\n\t\t\tonClick: this.handleClick,\r\n\t\t\tonContextMenu: this.handleRightClick,\r\n\t\t\tonTouchStart: this.handleTouchStart,\r\n\t\t\tonTouchMove: this.handleTouchMove,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<rect ref={this.saveNode}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twidth={width}\r\n\t\t\t\theight={height}\r\n\t\t\t\tstyle={{ opacity: 0 }}\r\n\t\t\t\t{...interactionProps}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n// \t\t\t\tonMouseEnter={this.handleEnter}\r\n//\t\t\t\tonMouseLeave={this.handleLeave}\r\n\r\n\r\nEventCapture.propTypes = {\r\n\tmouseMove: PropTypes.bool.isRequired,\r\n\tzoom: PropTypes.bool.isRequired,\r\n\tpan: PropTypes.bool.isRequired,\r\n\tpanSpeedMultiplier: PropTypes.number.isRequired,\r\n\tfocus: PropTypes.bool.isRequired,\r\n\tuseCrossHairStyleCursor: PropTypes.bool.isRequired,\r\n\r\n\twidth: PropTypes.number.isRequired,\r\n\theight: PropTypes.number.isRequired,\r\n\tchartConfig: PropTypes.array,\r\n\txScale: PropTypes.func.isRequired,\r\n\txAccessor: PropTypes.func.isRequired,\r\n\tdisableInteraction: PropTypes.bool.isRequired,\r\n\r\n\tgetAllPanConditions: PropTypes.func.isRequired,\r\n\r\n\tonMouseMove: PropTypes.func,\r\n\tonMouseEnter: PropTypes.func,\r\n\tonMouseLeave: PropTypes.func,\r\n\tonZoom: PropTypes.func,\r\n\tonPinchZoom: PropTypes.func,\r\n\tonPinchZoomEnd: PropTypes.func.isRequired,\r\n\tonPan: PropTypes.func,\r\n\tonPanEnd: PropTypes.func,\r\n\tonDragStart: PropTypes.func,\r\n\tonDrag: PropTypes.func,\r\n\tonDragComplete: PropTypes.func,\r\n\r\n\tonClick: PropTypes.func,\r\n\tonDoubleClick: PropTypes.func,\r\n\tonContextMenu: PropTypes.func,\r\n\tonMouseDown: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nEventCapture.defaultProps = {\r\n\tmouseMove: false,\r\n\tzoom: false,\r\n\tpan: false,\r\n\tpanSpeedMultiplier: 1,\r\n\tfocus: false,\r\n\tonDragComplete: noop,\r\n\tdisableInteraction: false,\r\n};\r\n\r\nexport default EventCapture;\r\n"]}