{"version":3,"sources":["../../../src/lib/series/BarSeries.js"],"names":["BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","identityStack","bars","getBars","clip","getAxisCanvas","Component","propTypes","baseAt","PropTypes","oneOfType","number","func","stroke","bool","width","yAccessor","isRequired","opacity","fill","string","className","defaultProps","StackedBarSeries","xScale","plotData","yScale","chartConfig","getFill","getBase","widthFunctor","offset","Math","floor","filter","d","map","yValue","y","x","round","h","height"],"mappings":"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","file":"BarSeries.js","sourcesContent":["\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport GenericChartComponent from \"../GenericChartComponent\";\r\nimport { getAxisCanvas } from \"../GenericComponent\";\r\n\r\nimport StackedBarSeries, {\r\n\tdrawOnCanvasHelper,\r\n\tdrawOnCanvas2,\r\n\tgetBarsSVG2,\r\n\tsvgHelper,\r\n\tidentityStack\r\n} from \"./StackedBarSeries\";\r\n\r\nimport { functor, isDefined } from \"../utils\";\r\n\r\nclass BarSeries extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.renderSVG = this.renderSVG.bind(this);\r\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\r\n\t}\r\n\tdrawOnCanvas(ctx, moreProps) {\r\n\t\tif (this.props.swapScales) {\r\n\t\t\tconst { xAccessor } = moreProps;\r\n\t\t\tdrawOnCanvasHelper(ctx, this.props, moreProps, xAccessor, identityStack);\r\n\t\t} else {\r\n\t\t\tconst bars = getBars(this.props, moreProps);\r\n\t\t\tdrawOnCanvas2(this.props, ctx, bars);\r\n\t\t}\r\n\r\n\t}\r\n\trenderSVG(moreProps) {\r\n\t\tif (this.props.swapScales) {\r\n\t\t\tconst { xAccessor } = moreProps;\r\n\t\t\treturn <g>{svgHelper(this.props, moreProps, xAccessor, identityStack)}</g>;\r\n\t\t} else {\r\n\t\t\tconst bars = getBars(this.props, moreProps);\r\n\t\t\treturn <g>{getBarsSVG2(this.props, bars)}</g>;\r\n\t\t}\r\n\r\n\t}\r\n\trender() {\r\n\t\tconst { clip } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<GenericChartComponent\r\n\t\t\t\tclip={clip}\r\n\t\t\t\tsvgDraw={this.renderSVG}\r\n\r\n\t\t\t\tcanvasToDraw={getAxisCanvas}\r\n\t\t\t\tcanvasDraw={this.drawOnCanvas}\r\n\r\n\t\t\t\tdrawOn={[\"pan\"]}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nBarSeries.propTypes = {\r\n\tbaseAt: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func,\r\n\t]),\r\n\tstroke: PropTypes.bool,\r\n\twidth: PropTypes.oneOfType([\r\n\t\tPropTypes.number,\r\n\t\tPropTypes.func\r\n\t]),\r\n\tyAccessor: PropTypes.func.isRequired,\r\n\topacity: PropTypes.number,\r\n\tfill: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]),\r\n\tclassName: PropTypes.oneOfType([\r\n\t\tPropTypes.func, PropTypes.string\r\n\t]),\r\n\tclip: PropTypes.bool,\r\n\tswapScales: PropTypes.bool,\r\n};\r\n\r\n\r\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\r\n\r\nexport default BarSeries;\r\n\r\n/*\r\n Initially, this program was using StackedBarSeries.getBars\r\n to benefit from code reuse and having a single place that\r\n contains the logic for drawing all types of bar charts\r\n simple, grouped, horizontal, but turnes out\r\n making it highly cuztimizable also made it slow for the\r\n most simple case, a regular bar chart.\r\n This function contains just the necessary logic\r\n to create bars\r\n*/\r\nfunction getBars(props, moreProps) {\r\n\tconst { baseAt, fill, stroke, yAccessor } = props;\r\n\tconst { xScale, xAccessor, plotData, chartConfig: { yScale } } = moreProps;\r\n\r\n\tconst getFill = functor(fill);\r\n\tconst getBase = functor(baseAt);\r\n\r\n\tconst widthFunctor = functor(props.width);\r\n\r\n\tconst width = widthFunctor(props, {\r\n\t\txScale,\r\n\t\txAccessor,\r\n\t\tplotData\r\n\t});\r\n\t/*\r\n\tconst barWidth = Math.round(width);\r\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\r\n\t*/\r\n\tconst offset = Math.floor(0.5 * width);\r\n\r\n\tconst bars = plotData\r\n\t\t.filter(d => isDefined(yAccessor(d)))\r\n\t\t.map(d => {\r\n\t\t\tconst yValue = yAccessor(d);\r\n\t\t\tlet y = yScale(yValue);\r\n\r\n\t\t\tconst x = Math.round(xScale(xAccessor(d))) - offset;\r\n\t\t\tlet h = getBase(xScale, yScale, d) - yScale(yValue);\r\n\r\n\t\t\tif (h < 0) {\r\n\t\t\t\ty = y + h;\r\n\t\t\t\th = -h;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\t// type: \"line\"\r\n\t\t\t\tx,\r\n\t\t\t\ty: Math.round(y),\r\n\t\t\t\theight: Math.round(h),\r\n\t\t\t\twidth: offset * 2,\r\n\t\t\t\tfill: getFill(d, 0),\r\n\t\t\t\tstroke: stroke ? getFill(d, 0) : \"none\",\r\n\t\t\t};\r\n\t\t});\r\n\r\n\treturn bars;\r\n}\r\n"]}